<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		*{
			margin: 0;
			padding: 0;
			user-select: none;
		}
		[v-cloak]{
			display: none;
		}
		#box{
			width: 200px;
			height: 200px;
			background: lightblue;
			margin: 40px;
			border-radius: 50%;
			position: relative;
		}
		#box img{
			width: 200px;
			height: 200px;
			border-radius: 50%;
		}
		#box span{
			width: 30px;
			height: 30px;
			display: block;
			/*background: blue;*/
			position: absolute;
			text-align: center;
			z-index: 3;
			font-size: 24px;
			line-height: 30px;
			top: 0;
			right: 0;
		}
		#box span img{
			width: 30px;
			height: 30px;
		}
	</style>
</head>
<body style="background: #000;">
	<div id="app">
		<div id="box" v-drag:rotate>
			<img src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2319196103,2510865082&fm=26&gp=0.jpg">
			<!-- <span id="tou" v-drag>×</span> -->
		</div>
	</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
<script type="text/javascript">
	var tou = document.querySelector('#tou');
	Vue.directive('drag',function(el,binding){

		if(binding.arg == 'rotate'){
			var span = document.createElement('span')
			var yue = document.createElement('img')
			// span.innerHTML='×'
			yue.src='https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1562040846620&di=31615e79488d8473cd415edc07295757&imgtype=0&src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fq_70%2Cc_zoom%2Cw_640%2Fimages%2F20180627%2Fd5f33057333d4df9a413ec44f5ae3ab9.jpeg'
			span.appendChild(yue)
			el.appendChild(span)
			span.onmousedown = function(event){
				console.log('hh')
				event.stopPropagation();
				var mouseDownX = event.pageX;
				var mouseDownY = event.pageY;
				document.onmousemove = function(e){
					var angle = getAngle(box.offsetLeft + 50,box.offsetTop + 50,e.pageX,e.pageY);
					box.style.transform = 'rotate('+angle+'deg)';
				}
			}
		}
		
		
		el.style.cursor = 'pointer';
		el.onmousedown = function(event){
			var mouseX = event.clientX;
			var mouseY = event.clientY;

			var offsetL = el.offsetLeft;
			var offsetT = el.offsetTop;

			console.log(mouseX,mouseY)

			document.onmousemove = function(e){
				var diffX = e.clientX - mouseX + offsetL;
				var diffY = e.clientY - mouseY + offsetT;

				el.style.left = diffX + 'px';
				el.style.top = diffY + 'px';
			}
		}
		document.onmouseup = function(){
			document.onmousemove = null;
		}
	});
	
	function getAngle(px,py,mx,my){//获得人物中心和鼠标坐标连线，与y轴正半轴之间的夹角
		var x = Math.abs(px-mx);
		var y = Math.abs(py-my);
		var z = Math.sqrt(Math.pow(x,2)+Math.pow(y,2));
		var cos = y/z;
		var radina = Math.acos(cos);//用反三角函数求弧度
		var angle = Math.floor(180/(Math.PI/radina));
		//将弧度转换成角度

		if(mx>px&&my>py){//鼠标在第四象限
			angle = 180 - angle;
		}

		if(mx==px&&my>py){//鼠标在y轴负方向上
			angle = 180;
		}

		if(mx>px&&my==py){//鼠标在x轴正方向上
			angle = 90;
		}

		if(mx<px&&my>py){//鼠标在第三象限
			angle = 180+angle;
		}

		if(mx<px&&my==py){//鼠标在x轴负方向
			angle = 270;
		}

		if(mx<px&&my<py){//鼠标在第二象限
			angle = 360 - angle;
		}
		return angle-45;
    }
	new Vue({
		el:'#app',
	})
</script>
</html>