<!DOCTYPE html>
<html lang="ch">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>拖拽盒子并旋转</title>
    <style>
        *{margin: 0;padding: 0;}
        #big{
            width: 150px;
            height: 150px;
            border: 1px solid;
            box-shadow: 3px 3px 10px #a3a3a3;
            /* margin: 200px auto; */
            /* position: relative; */
        }
        #span{
            width: 30px;
            height: 30px;
            background-color: #a3a3a3;
            position: absolute;
            top: 0;right: 0;
        }
    </style>
</head>
<body>
    <div class="box">
        <div id="big" v-drag>
            <div id="span"></div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>

        // var big = document.getElementById('big');
        // var span = document.getElementById('span');
        // el:指令所绑定的元素，用来操作DOM;
        Vue.directive('drag',function(el,binding){
            el.style.position = 'absolute';
            el.style.cursor = 'pointer';
            el.onmousedown = function(event){
                var mouseX = event.clientX;
                var mouseY = event.clientY;
                // 旋转
                document.onmousemove = function(e){
                    var angle = getAngle(big.offsetLeft+50,big.offsetTop+50,e.pageX,e.pageY);
                    
                    big.style.transform = 'rotate('+ angle +'deg)';
                }
                var offsetLeft = el.offsetLeft;
                var offsetTop = el.offsetTop;

                console.log(offsetLeft,offsetTop);
                // 拖动
                document.onmousemove = function(e){
                    // 移动的距离
                    var ydX = e.clientX - mouseX + offsetLeft;
                    var ydY = e.clientY - mouseY + offsetTop;
                    el.style.left = ydX + 'px';
                    el.style.top = ydY + 'px';
                }
            }
            document.onmouseup = function(e){
                document.onmousemove = null;
            }
        });

        function getAngle(px,py,mx,my){//获得人物中心和鼠标坐标连线，与y轴正半轴之间的夹角
			var x = Math.abs(px-mx);
			var y = Math.abs(py-my);
			var z = Math.sqrt(Math.pow(x,2)+Math.pow(y,2));
			var cos = y/z;
			var radina = Math.acos(cos);//用反三角函数求弧度
			var angle = Math.floor(180/(Math.PI/radina));//将弧度转换成角度

			if(mx>px&&my>py){//鼠标在第四象限
				angle = 180 - angle;
			}

			if(mx==px&&my>py){//鼠标在y轴负方向上
				angle = 180;
			}

			if(mx>px&&my==py){//鼠标在x轴正方向上
				angle = 90;
			}

			if(mx<px&&my>py){//鼠标在第三象限
				angle = 180+angle;
			}

			if(mx<px&&my==py){//鼠标在x轴负方向
				angle = 270;
			}

			if(mx<px&&my<py){//鼠标在第二象限
				angle = 360 - angle;
			}
		return angle-45;
    }

        new Vue({
            el:'.box',
        })
    </script>
</body>
</html>